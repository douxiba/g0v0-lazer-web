---
import dayjs from "dayjs";
import pinnedImage1 from "../../assets/images/pinned-news-illustrate.svg";
import { Pin, Newspaper } from "@lucide/astro";
import { Clock, UserPen } from "@lucide/astro";
import Button from "../general/Button.astro";

interface News {
	id: string;
	title: string;
	date: string;
	author: string;
	text: string;
	pinned?: boolean;
	image?: string;
}

interface Props {
	news: News[];
}

const { news = [] } = Astro.props;

// 取 pinned 新闻
const pinnedNews = news.find((n) => n.pinned);
// 非 pinned 新闻
const otherNews = news.filter((n) => !n.pinned);
---

<section class="my-12">
	<!-- 标题 -->
	<h2 class="text-4xl font-bold text-center text-zinc-800 dark:text-zinc-50">看看我们最近发生了啥新鲜事</h2>
	<p class="mt-2 text-xl text-center text-zinc-600 dark:text-zinc-400">在这里详细了解我们的最新新闻，包括活动通知/服务器公告等</p>

	<!-- 第一行：pinned 卡片 -->
	{
		pinnedNews && (
			<div class="mt-8">
				<div class="relative border border-primary-400 bg-primary-50 dark:bg-primary-950 dark:border-primary-700 rounded-xl px-6 py-4 shadow-sm flex flex-row gap-x-5">
					<div class="flex items-center justify-center">
						<img src={pinnedImage1.src} class="h-12 object-contain" />
					</div>
					<div class="flex flex-col justify-center">
						<div class="flex items-center">
							<h3 class="text-xl font-semibold text-gray-900 dark:text-zinc-100">{pinnedNews.title}</h3>
						</div>
						<p class="text-base text-neutral-700 dark:text-neutral-300">{pinnedNews.text}</p>
					</div>
					<div class="absolute top-4 right-4 flex flex-col">
						<div class="flex justify-end">
							<div class="flex flex-row items-center gap-x-0.5 py-0.5 px-1.5 text-sm rounded-full bg-primary-100 dark:bg-primary-800 border-solid border-1 border-primary-400 dark:bg-primary-600 text-primary-700 dark:text-primary-100">
								<Pin class="h-4 w-4" />
								<span>置顶公告</span>
							</div>
						</div>
						<div class="text-sm text-primary-800 dark:text-primary-100 mt-1">
							发布于: {dayjs(pinnedNews.date).format("YYYY-M-DD HH:mm:ss")}
						</div>
					</div>
				</div>
			</div>
		)
	}

	<!-- 第二/三行：每行 3 个卡片 -->
	<div class="mt-8 grid gap-6 sm:grid-cols-2 lg:grid-cols-3">
		{
			otherNews.map((newsItem) => (
				<article class="bg-white dark:bg-zinc-900 rounded-xl border-solid border-zinc-200 dark:border-zinc-700 border-1 overflow-hidden transition-all duration-150 ease-in-out group hover:border-primary-300 hover:dark:border-primary-800 hover:bg-primary-50 hover:dark:bg-primary-950">
					{newsItem.image && (
						<div class="w-full aspect-[2/1] brightness-90 group-hover:brightness-100 dark:brightness-100 dark:group-hover:brightness-110 transition-all duration-100 ease-in-out overflow-hidden">
							<img src={newsItem.image} alt={newsItem.title} class="w-full h-full object-cover" />
						</div>
					)}
					<div class="p-4 border-solid border-t-1 border-zinc-200 dark:border-zinc-700 group-hover:border-primary-300 dark:group-hover:border-primary-800">
						<h3 class="text-lg text-ellipsis font-semibold line-clamp-1 text-gray-900 group-hover:text-primary-800 dark:text-zinc-100 dark:group-hover:text-primary-100">
							{newsItem.title}
						</h3>
						<div class="mt-0.5 text-sm text-zinc-600 dark:text-zinc-300 group-hover:text-primary-800/75 dark:group-hover:text-primary-300 leading-normal transition-all duration-150 ease-in-out line-clamp-3 flex flex-row items-center">
							<Clock class="h-4 w-4 mr-1" />
							<span>{newsItem.date}</span>
							<UserPen class="h-4 w-4 ml-3 mr-1" />
							<span>{newsItem.author}</span>
						</div>
					</div>
				</article>
			))
		}
	</div>

	<!-- 显示更多按钮 -->
	<div class="mt-10 text-center">
		<Button variant="primary" appearance="outlined" rounded="all" size={["px-6", "py-2"]}>
			<Newspaper slot="prefix" class="h-5 w-5 mr-1" />
			查看全部新闻
		</Button>
	</div>
</section>
